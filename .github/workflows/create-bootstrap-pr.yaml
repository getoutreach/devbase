name: Create Bootstrap PR
on:
  release:
    types: [published]

jobs:
  create-bootstrap-pr:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          token: ${{ secrets.PAT_OUTREACH_CI }}
          repository: getoutreach/bootstrap
          ref: "main"
      - name: Bump devbase
        run: |-
          VERSION="${{ github.event.release.tag_name }}"
          VERSION="${VERSION/v/}"
          sed -i -E 's/devbase: (.+)/devbase: $VERSION/' versions.yaml
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v4
        with:
          token: ${{ secrets.PAT_OUTREACH_CI }}
          commit-message: "fix: Update devbase to ${{ github.event.release.tag_name }}"
          title: "fix: Update devbase to ${{ github.event.release.tag_name }}"
          labels: "devbase"
          branch: generated/devbase-${{ github.event.release.tag_name }}
          delete-branch: true
          body: |-
            Automatically generated PR to update devbase to ${{ github.event.release.tag_name }}.

            For release information, see: [${{ github.event.release.tag_name }}](https://github.com/getoutreach/devbase/releases/${{ github.event.release.tag_name }})
