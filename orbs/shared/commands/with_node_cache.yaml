description: Restore node cache to a standard path based on a standard path, then run yarn. Optionally save cache after.
parameters:
  save:
    type: boolean
    default: false
steps:
  - restore_cache:
      keys:
        - release-node-cache-{{ checksum "cache-version.txt" }}-{{ checksum "package.json" }}
        - release-node-cache-{{ checksum "cache-version.txt" }}
  - run:
      name: Install semantic-release Dependencies
      command: |
        if [[ -n $CIRCLE_PR_REPONAME ]]; then
          echo -e '\e[1;33mWARNING:\e[0m skipping yarn install due to forked PR' >&2
        else
          yarn --frozen-lockfile
        fi
  - when:
      condition: << parameters.save >>
      steps:
        - save_node_cache
