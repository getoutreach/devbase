description: Checks if the PR is Draft and it's requested by pipeline to skip that step
parameters:
  should_fail:
    description: Should fail the step, otherwise just halt the remaining job
    type: boolean
    default: true
  force_draft_run:
    description: Should run although it is a draft PR
    type: boolean
    default: false
steps:
  - run:
      name: Check being Draft PR
      command: |-
        SHOULD_FAIL="<< parameters.should_fail >>"
        FORCE_DRAFT_RUN="<< parameters.force_draft_run >>"
        if [[ $FORCE_DRAFT_RUN = "true" ]]; then
          echo "Forcing run for this PR"
        elif [[ -f "/tmp/pr_draft.txt" ]]; then
          circleci-agent step halt
          if [[ $SHOULD_FAIL = "true" ]]; then
            echo "Failing job for Draft PR"
            exit 1
          else 
            echo "Halting the pipeline for Draft PR, remaining steps are not running."
          fi
        else
          echo "Continue, no Draft"
        fi          
